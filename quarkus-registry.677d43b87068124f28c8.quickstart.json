{"apiVersion":"console.openshift.io/v1","kind":"QuickStarts","metadata":{"name":"quarkus-service-registry","annotations":{"draft":false,"order":2}},"spec":{"version":0.1,"type":{"text":"Quick start","color":"green"},"displayName":"Using Quarkus applications with Kafka instances and Red Hat OpenShift Service Registry","durationMinutes":10,"icon":"data:image/svg+xml;base64,PHN2ZyBpZD0iZTA1M2ZiYWQtY2I0Ny00OGNiLThiNDMtZDczY2RmMzQyNGJjIiBkYXRhLW5hbWU9IkxheWVyIDEiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIgdmlld0JveD0iMCAwIDM3IDM3Ij4KICA8ZGVmcz4KICAgIDxzdHlsZT4KICAgICAgLmE0NjBjMWU3LWMyNjAtNDc5MS1iZjc0LTI0ZmE4OGU4MTcwZSB7CiAgICAgICAgZmlsbDogI2UwMDsKICAgICAgfQoKICAgICAgLmU4YTQ2MmQ1LTgzYWUtNGRjMi04OTVlLWE3NDU3ZjY2MDNjYSB7CiAgICAgICAgZmlsbDogI2ZmZjsKICAgICAgfQogICAgPC9zdHlsZT4KICA8L2RlZnM+CiAgPHBhdGggZD0iTTI3LjUuNUg5LjVhOSw5LDAsMCwwLTksOXYxOGE5LDksMCwwLDAsOSw5aDE4YTksOSwwLDAsMCw5LTlWOS41YTksOSwwLDAsMC05LTlaIi8+CiAgPHBhdGggY2xhc3M9ImE0NjBjMWU3LWMyNjAtNDc5MS1iZjc0LTI0ZmE4OGU4MTcwZSIgZD0iTTI2LjUsMjcuMTI1aC02YS42MjUuNjI1LDAsMCwxLS42MjUtLjYyNXYtNmEuNjI1LjYyNSwwLDAsMSwuNjI1LS42MjVoNmEuNjI1LjYyNSwwLDAsMSwuNjI1LjYyNXY2QS42MjUuNjI1LDAsMCwxLDI2LjUsMjcuMTI1Wm0tNS4zNzUtMS4yNWg0Ljc1di00Ljc1aC00Ljc1WiIvPgogIDxwYXRoIGNsYXNzPSJhNDYwYzFlNy1jMjYwLTQ3OTEtYmY3NC0yNGZhODhlODE3MGUiIGQ9Ik0yNi41LDE3LjEyNWgtNmEuNjI1LjYyNSwwLDAsMS0uNjI1LS42MjV2LTZhLjYyNS42MjUsMCwwLDEsLjYyNS0uNjI1aDZhLjYyNS42MjUsMCwwLDEsLjYyNS42MjV2NkEuNjI1LjYyNSwwLDAsMSwyNi41LDE3LjEyNVptLTUuMzc1LTEuMjVoNC43NXYtNC43NWgtNC43NVoiLz4KICA8cGF0aCBjbGFzcz0iYTQ2MGMxZTctYzI2MC00NzkxLWJmNzQtMjRmYTg4ZTgxNzBlIiBkPSJNMTYuNSwxNy4xMjVoLTZhLjYyNS42MjUsMCwwLDEtLjYyNS0uNjI1di02YS42MjUuNjI1LDAsMCwxLC42MjUtLjYyNWg2YS42MjUuNjI1LDAsMCwxLC42MjUuNjI1djZBLjYyNS42MjUsMCwwLDEsMTYuNSwxNy4xMjVabS01LjM3NS0xLjI1aDQuNzV2LTQuNzVoLTQuNzVaIi8+CiAgPHBhdGggY2xhc3M9ImU4YTQ2MmQ1LTgzYWUtNGRjMi04OTVlLWE3NDU3ZjY2MDNjYSIgZD0iTTE2LjUsMTkuODc1aC01YS42MjUuNjI1LDAsMCwwLDAsMS4yNWgzLjQ5MWwtNC45MzMsNC45MzNhLjYyNS42MjUsMCwwLDAsLjg4NC44ODRsNC45MzMtNC45MzNWMjUuNWEuNjI1LjYyNSwwLDAsMCwxLjI1LDB2LTVBLjYyNS42MjUsMCwwLDAsMTYuNSwxOS44NzVaIi8+Cjwvc3ZnPgo=","description":"<div id=\"description\" class=\"paragraph\">\n<p>Learn how to use a Quarkus application that produces messages to and consume messages from a Kafka instance in Red Hat OpenShift Streams for Apache Kafka and manage the message schemas in Red Hat OpenShift Service Registry.</p>\n</div>","prerequisites":["A running Kafka instance (see the Getting started with Kafka quick start)","A running Service Registry instance (see the Getting started with Service Registry quick start)","A command-line terminal application","Git","An IDE","OpenJDK 11 or later for Linux or MacOS (the latest LTS version of OpenJDK is recommended)","Apache Maven 3.8.x or later (for Quarkus 2.2.x)"],"introduction":"<div id=\"introduction\" class=\"paragraph\">\n<p>Welcome to the quick start for Red Hat OpenShift Service Registry with Quarkus. In this quick start, you&#8217;ll learn how to use <a href=\"https://quarkus.io/\" target=\"_blank\" rel=\"noopener\">Quarkus</a> to produce messages to and consume messages from your Kafka instances in OpenShift Streams for Apache Kafka and manage the message schemas in Red Hat OpenShift Service Registry.</p>\n</div>","tasks":["<div class=\"sect1\">\n<h2 id=\"proc-importing-quarkus-registry-sample-code_quarkus-service-registry\">Importing the Quarkus sample code</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph _abstract\">\n<p>For this quick start, you&#8217;ll use the Quarkus Service Registry sample code from the App Services <a href=\"https://github.com/redhat-developer/app-services-guides\" target=\"_blank\" rel=\"noopener\">Guides and Samples</a> repository in GitHub. After you understand the concepts and tasks in this quick start, you can use your own Quarkus applications with OpenShift Streams for Apache Kafka and Service Registry in the same way.</p>\n</div>\n<div class=\"olist\"><div class=\"title\">Procedure</div><div class=\"task-pflist\"><h6 data-ouia-component-type=\"PF4/Title\" data-ouia-safe=\"true\" data-ouia-component-id=\"OUIA-Generated-Title-33\" class=\"pf-c-title pf-m-md task-pflist-title\">Procedure</h6><ol type=\"1\" class=\"pf-c-list task-pflist-list task-pflist-list--proc\"><li class=\"task-pflist-list__item--proc task-pflist-list__item\"><span class=\"task-pflist-list__item__content\"><p>On the command line, clone the App Services <a href=\"https://github.com/redhat-developer/app-services-guides\" target=\"_blank\" rel=\"noopener\">Guides and Samples</a> repository from GitHub.</p> <div class=\"listingblock\">\n<div class=\"title\">Cloning the guides and samples repository</div>\n<div class=\"content\">\n<pre class=\"highlight\"><code>git clone https://github.com/redhat-developer/app-services-guides app-services-guides</code></pre>\n</div>\n</div></span></li><li class=\"task-pflist-list__item--proc task-pflist-list__item\"><span class=\"task-pflist-list__item__content\"><p>In your IDE, open the <code>code-examples/quarkus-service-registry-quickstart</code> directory from the repository that you cloned.</p> </span></li></ol></div></div>\n<div class=\"ulist\">\n<div class=\"title\">Verification</div>\n<ul>\n<li>\n<p>Is the Quarkus example application accessible in your IDE?</p>\n</li>\n</ul>\n</div>\n</div>\n</div>","<div class=\"sect1\">\n<h2 id=\"proc-configuring-quarkus-registry-app_quarkus-service-registry\">Configuring the Quarkus application to connect to Kafka and Service Registry instances</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph _abstract\">\n<p>To enable your Quarkus applications to access a Kafka instance, configure the connection properties using the Kafka bootstrap server endpoint. To access a Service Registry instance, configure the registry endpoint connection property with the Core Registry API value.</p>\n</div>\n<div class=\"paragraph\">\n<p>Access to the Service Registry and Kafka instances is managed using the same service account and SASL/OAUTHBEARER token endpoint. For Quarkus, you can configure all connection properties using the <code>application.properties</code> file. This example sets environment variables and references them in this file.</p>\n</div>\n<div class=\"paragraph\">\n<p>Quarkus applications use <a href=\"https://github.com/eclipse/microprofile-reactive-messaging\" target=\"_blank\" rel=\"noopener\">MicroProfile Reactive Messaging</a> to produce messages to and consume messages from your Kafka instances in OpenShift Streams for Apache Kafka. For details on configuration options, see the <a href=\"https://quarkus.io/guides/kafka\" target=\"_blank\" rel=\"noopener\">Apache Kafka Reference Guide</a> in the Quarkus documentation.</p>\n</div>\n<div class=\"paragraph\">\n<p>This Quarkus example application includes producer and consumer processes that serialize/deserialize Kafka messages using a schema stored in Service Registry.</p>\n</div>\n<div class=\"olist\"><div class=\"title\">Procedure</div><div class=\"task-pflist\"><h6 data-ouia-component-type=\"PF4/Title\" data-ouia-safe=\"true\" data-ouia-component-id=\"OUIA-Generated-Title-34\" class=\"pf-c-title pf-m-md task-pflist-title\">Procedure</h6><ol type=\"1\" class=\"pf-c-list task-pflist-list task-pflist-list--proc\"><li class=\"task-pflist-list__item--proc task-pflist-list__item\"><span class=\"task-pflist-list__item__content\"><p>On the command line, set the following environment variables to use your Kafka and Service Registry instances with Quarkus or other applications. Replace the values with your own server and credential information:</p> <div class=\"ulist\">\n<ul>\n<li>\n<p>The <code>&lt;bootstrap_server&gt;</code> is the bootstrap server endpoint for your Kafka instance.</p>\n</li>\n<li>\n<p>The <code>&lt;core_registry_url&gt;</code> is the Core Registry API endpoint for your Service Registry instance.</p>\n</li>\n<li>\n<p>The <code>&lt;oauth_token_endpoint_uri&gt;</code> is the SASL/OAUTHBEARER token endpoint.</p>\n</li>\n<li>\n<p>The <code>&lt;client_id&gt;</code> and <code>&lt;client_secret&gt;</code> are the generated credentials for your service account.</p>\n<div class=\"listingblock\">\n<div class=\"title\">Setting environment variables for server and credentials</div>\n<div class=\"content\">\n<pre class=\"highlight\"><code>$ export BOOTSTRAP_SERVER=<em>&lt;bootstrap_server&gt;</em>\n$ export REGISTRY_URL=<em>&lt;core_registry_url&gt;</em>\n$ export OAUTH_TOKEN_ENDPOINT_URI=<em>&lt;oauth_token_endpoint_uri&gt;</em>\n$ export CLIENT_ID=<em>&lt;client_id&gt;</em>\n$ export CLIENT_SECRET=<em>&lt;client_secret&gt;</em></code></pre>\n</div>\n</div>\n</li>\n</ul>\n</div></span></li><li class=\"task-pflist-list__item--proc task-pflist-list__item\"><span class=\"task-pflist-list__item__content\"><p>In the Quarkus example application, review the <code>/src/main/resources/application.properties</code> files in the <code>consumer</code> and <code>producer</code> sub-folders to understand how the environment variables you set in the previous step are used. This example uses the <code>dev</code> configuration profile in the <code>application.properties</code> files.</p> </span></li></ol></div></div>\n<div class=\"ulist\">\n<div class=\"title\">Verification</div>\n<ul>\n<li>\n<p>Did you set the required environment variables for accessing your services?</p>\n</li>\n</ul>\n</div>\n</div>\n</div>","<div class=\"sect1\">\n<h2 id=\"proc-create-prices-topic-registry_quarkus-service-registry\">Creating the quotes Kafka topic in OpenShift Streams for Apache Kafka</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph _abstract\">\n<p>For this quick start, the Kafka topic that the Quarkus example application uses is called <code>quotes</code>. You must create this topic in OpenShift Streams for Apache Kafka so that the Quarkus application can interact with it.</p>\n</div>\n<div class=\"ulist\"><div class=\"title\">Prerequisites</div><div class=\"task-pflist\"><h6 data-ouia-component-type=\"PF4/Title\" data-ouia-safe=\"true\" data-ouia-component-id=\"OUIA-Generated-Title-35\" class=\"pf-c-title pf-m-md task-pflist-title\">Prerequisites</h6><p class=\"task-pflist-subtitle\">In addtion to the prerequisites for this Quick Start, this step requires:</p><ul class=\"pf-c-list task-pflist-list task-pflist-list--prereq\"><li class=\"task-pflist-list__item--prereq task-pflist-list__item\"><span class=\"task-pflist-list__item__content\"><p>You&#8217;re logged in to the OpenShift Streams for Apache Kafka web console at <a href=\"https://console.redhat.com/application-services/streams/\" class=\"bare\" target=\"_blank\" rel=\"noopener\">https://console.redhat.com/application-services/streams/</a>.</p> </span></li><li class=\"task-pflist-list__item--prereq task-pflist-list__item\"><span class=\"task-pflist-list__item__content\"><p>You&#8217;ve created a Kafka instance in OpenShift Streams for Apache Kafka and the instance is in <strong>Ready</strong> state.</p> </span></li></ul></div></div>\n<div class=\"olist\"><div class=\"title\">Procedure</div><div class=\"task-pflist\"><h6 data-ouia-component-type=\"PF4/Title\" data-ouia-safe=\"true\" data-ouia-component-id=\"OUIA-Generated-Title-36\" class=\"pf-c-title pf-m-md task-pflist-title\">Procedure</h6><ol type=\"1\" class=\"pf-c-list task-pflist-list task-pflist-list--proc\"><li class=\"task-pflist-list__item--proc task-pflist-list__item\"><span class=\"task-pflist-list__item__content\"><p>In the OpenShift Streams for Apache Kafka web console, go to <strong>Streams for Apache Kafka</strong> &gt; <strong>Kafka Instances</strong> and click the name of the Kafka instance that you want to add a topic to.</p> </span></li><li class=\"task-pflist-list__item--proc task-pflist-list__item\"><span class=\"task-pflist-list__item__content\"><p>Select the <strong>Topics</strong> tab, click <strong>Create topic</strong>, and follow the guided steps to define the topic details. Click <strong>Next</strong> to complete each step and click <strong>Finish</strong> to complete the setup.</p> <div class=\"imageblock screencapture\">\n<div class=\"content\">\n<img src=\"./images/sak-create-topic.png\" alt=\"Image of wizard to create a topic\">\n</div>\n<div class=\"title\">Figure 1. Guided steps to define topic details</div>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p><strong>Topic name</strong>: Enter <code>quotes</code> as the topic name.</p>\n</li>\n<li>\n<p><strong>Partitions</strong>: Set the number of partitions for this topic. This example sets the partition to <code>1</code> for a single partition. Partitions are distinct lists of messages in a topic and enable parts of a topic to be distributed over multiple brokers in the cluster. A topic can contain one or more partitions, enabling producer and consumer loads to be scaled.</p>\n</li>\n<li>\n<p><strong>Message retention</strong>: Set the message retention time and size to the relevant value and increment. This example sets the retention time to <code>A week</code> and the retention size to <code>Unlimited</code>. Message retention time is the amount of time that messages are retained in a topic before they are deleted or compacted, depending on the cleanup policy. Retention size is the maximum total size of all log segments in a partition before they are deleted or compacted.</p>\n</li>\n<li>\n<p><strong>Replicas</strong>: For this release of OpenShift Streams for Apache Kafka, the replicas are preconfigured. The number of partition replicas for the topic is set to <code>3</code> and the minimum number of follower replicas that must be in sync with a partition leader is set to <code>2</code>.</p>\n<div class=\"paragraph\">\n<p>Replicas are copies of partitions in a topic. Partition replicas are distributed over multiple brokers in the cluster to ensure topic availability if a broker fails. When a follower replica is in sync with a partition leader, the follower replica can become the new partition leader if needed.</p>\n</div>\n<div class=\"paragraph\">\n<p>After you complete the topic setup, the new Kafka topic is listed in the topics table. You can now run the Quarkus application to start producing and consuming messages using this topic.</p>\n</div>\n</li>\n</ul>\n</div></span></li></ol></div></div>\n<div class=\"ulist\">\n<div class=\"title\">Verification</div>\n<ul>\n<li>\n<p>Is the new <code>quotes</code> Kafka topic listed in the topics table?</p>\n</li>\n</ul>\n</div>\n</div>\n</div>","<div class=\"sect1\">\n<h2 id=\"proc-running-quarkus-registry-example-app_quarkus-service-registry\">Running the Quarkus example application</h2>\n<div class=\"sectionbody\">\n<div class=\"paragraph _abstract\">\n<p>After you configure your Quarkus application to connect to Kafka and Service Registry instances, and you create the Kafka topic, you can run the Quarkus application to start producing and consuming messages to and from this topic.</p>\n</div>\n<div class=\"paragraph\">\n<p>The Quarkus application in this quick start consists of two processes:</p>\n</div>\n<div class=\"ulist\">\n<ul>\n<li>\n<p>The consumer process is implemented by the <code>QuotesResource</code> class. This class exposes the <code>/quotes</code> REST endpoint that streams quotes from the <code>quotes</code> topic. This process also has a minimal frontend that streams quotes using Server-Sent Events to the web page.</p>\n</li>\n<li>\n<p>The producer process is implemented by the <code>QuotesProducer</code> class. This class produces a new quote periodically (every 5 seconds) with a random quote value that is published to the <code>quotes</code> topic.</p>\n</li>\n</ul>\n</div>\n<div class=\"ulist\"><div class=\"title\">Prerequisites</div><div class=\"task-pflist\"><h6 data-ouia-component-type=\"PF4/Title\" data-ouia-safe=\"true\" data-ouia-component-id=\"OUIA-Generated-Title-37\" class=\"pf-c-title pf-m-md task-pflist-title\">Prerequisites</h6><p class=\"task-pflist-subtitle\">In addtion to the prerequisites for this Quick Start, this step requires:</p><ul class=\"pf-c-list task-pflist-list task-pflist-list--prereq\"><li class=\"task-pflist-list__item--prereq task-pflist-list__item\"><span class=\"task-pflist-list__item__content\"><p>You&#8217;ve configured the Quarkus example application to connect to the Kafka and Service Registry instances.</p> </span></li><li class=\"task-pflist-list__item--prereq task-pflist-list__item\"><span class=\"task-pflist-list__item__content\"><p>You&#8217;ve created the Kafka <code>quotes</code> topic.</p> </span></li></ul></div></div>\n<div class=\"olist\"><div class=\"title\">Procedure</div><div class=\"task-pflist\"><h6 data-ouia-component-type=\"PF4/Title\" data-ouia-safe=\"true\" data-ouia-component-id=\"OUIA-Generated-Title-38\" class=\"pf-c-title pf-m-md task-pflist-title\">Procedure</h6><ol type=\"1\" class=\"pf-c-list task-pflist-list task-pflist-list--proc\"><li class=\"task-pflist-list__item--proc task-pflist-list__item\"><span class=\"task-pflist-list__item__content\"><p>On the command line, change to the <code>code-examples/quarkus-service-registry-quickstart/consumer</code> directory that you imported and run the consumer process.</p> <div class=\"listingblock\">\n<div class=\"title\">Running the example consumer process</div>\n<div class=\"content\">\n<pre class=\"highlight\"><code>$ cd ~/code-examples/quarkus-service-registry-quickstart/consumer\n$ mvn quarkus:dev</code></pre>\n</div>\n</div></span></li><li class=\"task-pflist-list__item--proc task-pflist-list__item\"><span class=\"task-pflist-list__item__content\"><p>After the consumer process is running, in a web browser, go to <a href=\"http://localhost:8080/quotes.html\" class=\"bare\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/quotes.html</a> and verify that this process is available.</p> </span></li><li class=\"task-pflist-list__item--proc task-pflist-list__item\"><span class=\"task-pflist-list__item__content\"><p>Leave the consumer process running, and run the producer process on a different terminal.</p> <div class=\"listingblock\">\n<div class=\"title\">Running the example producer process</div>\n<div class=\"content\">\n<pre class=\"highlight\"><code>$ cd ~/code-examples/quarkus-service-registry-quickstart/producer\n$ mvn quarkus:dev</code></pre>\n</div>\n</div></span></li><li class=\"task-pflist-list__item--proc task-pflist-list__item\"><span class=\"task-pflist-list__item__content\"><p>When both the consumer and producer processes are running, view the generated quotes in the web browser at <a href=\"http://localhost:8080/quotes.html\" class=\"bare\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/quotes.html</a>.</p> </span></li><li class=\"task-pflist-list__item--proc task-pflist-list__item\"><span class=\"task-pflist-list__item__content\"><p>In the web console, go to <strong>Service Registry</strong> &gt; <strong>Service Registry Instances</strong>,  select your Service Registry instance, and view the automatically generated schema for your application.</p> </span></li></ol></div></div>\n<div class=\"ulist\">\n<div class=\"title\">What just happened?</div>\n<ul>\n<li>\n<p>The Quarkus application is configured to use the <code>io.apicurio.registry.serde.avro.AvroKafkaSerializer</code> Java class for serializing and the <code>io.apicurio.registry.serde.avro.AvroKafkaDeserializer</code> class for deserializing messages to Avro format. This SerDes is configured to use remote schemas in Red Hat OpenShift Service Registry rather than the local schemas in the application.</p>\n</li>\n<li>\n<p>Because there are no schemas in the Service Registry instance, the SerDes published the schema for the <code>quotes</code> topic. The name of the schema is managed by the <code>TopicRecordIdStrategy</code> class, which uses the <code>topic_name-value</code> convention. You can find this schema in the Service Registry instance and configure compatability rules to govern how the schema can evolve for future versions.</p>\n</li>\n<li>\n<p>If the Quarkus application fails to run, review the error log in the terminal and address any problems. Also review the steps in this quick start to ensure that the Quarkus application and Kafka topic are configured correctly.</p>\n</li>\n</ul>\n</div>\n<div class=\"ulist\">\n<div class=\"title\">Verification</div>\n<ul>\n<li>\n<p>Did the Quarkus example application run without any errors?</p>\n</li>\n<li>\n<p>Did you see the generated quotes at <a href=\"http://localhost:8080/quotes.html\" class=\"bare\" target=\"_blank\" rel=\"noopener\">http://localhost:8080/quotes.html</a>?</p>\n</li>\n<li>\n<p>Did you see generated schemas in the Service Registry instance?</p>\n</li>\n</ul>\n</div>\n<div id=\"conclusion\" class=\"paragraph\">\n<p>Congratulations! You successfully completed the OpenShift Streams for Apache Kafka and Service Registry Quarkus quick start, and are now ready to use your own Quarkus application with OpenShift Streams for Apache Kafka and Service Registry.</p>\n</div>\n</div>\n</div>"],"conclusion":"<div id=\"conclusion\" class=\"paragraph\">\n<p>Congratulations! You successfully completed the OpenShift Streams for Apache Kafka and Service Registry Quarkus quick start, and are now ready to use your own Quarkus application with OpenShift Streams for Apache Kafka and Service Registry.</p>\n</div>","nextQuickStart":["service-discovery"]}}